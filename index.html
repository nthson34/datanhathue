<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>D·ªÆ LI·ªÜU NH√Ä THU√ä</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
body { background:#f1f5f9; }

.thumb {
  background-size: cover;
  background-position: center;
  border-radius: 14px;
  height: 120px;
  touch-action: manipulation;
}

#imgModal {
  touch-action: none;
}

#modalImg {
  transition: transform .15s ease;
  transform-origin: center;
}
</style>
</head>

<body>

<main id="list" class="max-w-3xl mx-auto p-3"></main>

<!-- ================= POPUP ================= -->
<div id="imgModal"
  class="fixed inset-0 bg-black/90 hidden z-50 flex items-center justify-center">

  <div id="imgCount" class="absolute top-4 left-4 text-white text-sm"></div>

  <button onclick="closeModal()"
    class="absolute top-4 right-4 text-white text-3xl font-bold">‚úï</button>

  <img id="modalImg"
    class="max-w-[95%] max-h-[90%] rounded-xl select-none">

</div>

<script>
/* ================= DATA DEMO ================= */
const DATA = [
  {
    address:"68 CMT8",
    price:"6 tri·ªáu",
    images:[
      "https://lh3.googleusercontent.com/d/1tXGJZxZExample=w1600",
      "https://lh3.googleusercontent.com/d/1tXGJZxZExample2=w1600"
    ]
  }
];

/* ================= RENDER ================= */
function render(){
  list.innerHTML = DATA.map((i,ci)=>`
    <div class="bg-white p-4 rounded-xl shadow mb-4 space-y-3">
      <div class="grid grid-cols-3 gap-2">
        ${i.images.map((img,idx)=>`
          <div class="thumb"
            data-card="${ci}"
            data-idx="${idx}"
            style="background-image:url('${img}')">
          </div>
        `).join('')}
      </div>
      <div class="font-bold">üìç ${i.address}</div>
      <div class="text-red-600 font-extrabold">üí∞ ${i.price}</div>
    </div>
  `).join('');
}
render();

/* ================= POPUP LOGIC ================= */
let modalImages=[], index=0;
let scale=1, dx=0, dy=0;
let startX=0, startY=0, startDist=0;

document.addEventListener('pointerdown',e=>{
  const t = e.target.closest('.thumb');
  if(!t) return;

  e.preventDefault();
  e.stopPropagation();

  modalImages = DATA[t.dataset.card].images;
  index = +t.dataset.idx;

  reset();
  openModal();
});

function openModal(){
  modalImg.src = modalImages[index];
  imgCount.innerText = `${index+1}/${modalImages.length}`;
  imgModal.classList.remove('hidden');
}

function closeModal(){
  imgModal.classList.add('hidden');
}

function reset(){
  scale=1; dx=0; dy=0;
  apply();
}

function apply(){
  modalImg.style.transform =
    `translate(${dx}px,${dy}px) scale(${scale})`;
}

/* ================= TOUCH ================= */
imgModal.addEventListener('touchstart',e=>{
  if(e.touches.length===2){
    startDist = dist(e.touches);
  }else{
    startX = e.touches[0].clientX;
    startY = e.touches[0].clientY;
  }
},{passive:false});

imgModal.addEventListener('touchmove',e=>{
  e.preventDefault();
  if(e.touches.length===2){
    let d = dist(e.touches);
    scale = Math.min(Math.max(1, scale*d/startDist),3);
    startDist=d;
  }else if(scale>1){
    dx += e.touches[0].clientX-startX;
    dy += e.touches[0].clientY-startY;
    startX=e.touches[0].clientX;
    startY=e.touches[0].clientY;
  }
  apply();
},{passive:false});

imgModal.addEventListener('touchend',()=>{
  if(scale===1 && Math.abs(dx)>80){
    index = dx<0
      ? (index+1)%modalImages.length
      : (index-1+modalImages.length)%modalImages.length;
    reset();
    openModal();
  }
});

/* ================= UTIL ================= */
function dist(t){
  return Math.hypot(
    t[0].clientX-t[1].clientX,
    t[0].clientY-t[1].clientY
  );
}
</script>

</body>
</html>
